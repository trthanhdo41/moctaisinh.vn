<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Admin | taisinh.vn ‚Äì Qu·∫£n tr·ªã h·ªá th·ªëng</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --main-blue: #7EC8E3;
      --main-blue-dark: #5bb0d6;
      --main-white: #fff;
      --main-silver: #e0e0e0;
    }
    body { background: var(--main-white); }
    .admin-sidebar {
      background: var(--main-blue);
      color: #fff;
      min-height: 100vh;
      padding: 32px 0 0 0;
      position: fixed;
      left: 0;
      top: 0;
      width: 220px;
      z-index: 1040;
      transition: transform 0.4s cubic-bezier(.4,2,.6,1);
      transform: translateX(0);
      box-shadow: 2px 0 8px rgba(126,200,227,0.08);
    }
    .admin-sidebar.closed { transform: translateX(-100%); }
    .admin-sidebar h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      text-align: center;
      color: #fff;
      border-radius: 12px;
      padding: 12px 0;
      box-shadow: none;
      border: none;
    }
    .admin-sidebar ul { list-style: none; padding: 0; }
    .admin-sidebar li { margin-bottom: 18px; }
    .admin-sidebar a {
      color: #fff;
      font-weight: 500;
      display: block;
      padding: 10px 32px;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .admin-sidebar a.active, .admin-sidebar a:hover {
      background: var(--main-blue-dark);
      text-decoration: none;
      color: #fff;
    }
    .admin-sidebar a,
    .admin-sidebar a:active,
    .admin-sidebar a:focus,
    .admin-sidebar a:hover {
      text-decoration: none !important;
    }
    .admin-content {
      padding: 40px 32px;
      margin-left: 220px;
      transition: margin-left 0.4s cubic-bezier(.4,2,.6,1);
      min-height: 100vh;
      background: var(--main-white);
    }
    .sidebar-closed .admin-content { margin-left: 0; }
    .admin-table th, .admin-table td { vertical-align: middle; }
    .admin-table th {
      background: var(--main-blue);
      color: #fff;
      border-bottom: 2px solid var(--main-silver);
    }
    .admin-table tr { background: var(--main-white); }
    .admin-table tr:nth-child(even) { background: #f5fafd; }
    .admin-table th, .admin-table td {
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      border-color: var(--main-silver);
    }
    .admin-table td:nth-child(4) {
      white-space: normal;
      word-break: break-word;
      max-width: 250px;
    }
    .admin-table td img {
      max-width: 60px;
      max-height: 60px;
      border: 1px solid var(--main-silver);
      background: var(--main-silver);
      border-radius: 6px;
    }
    .admin-section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 24px;
      color: var(--main-blue-dark);
    }
    .admin-btn {
      border-radius: 8px;
      padding: 8px 18px;
      font-weight: 500;
      background: var(--main-blue);
      color: #fff;
      border: none;
      transition: background 0.2s;
    }
    .admin-btn:hover, .admin-btn:focus {
      background: var(--main-blue-dark);
      color: #fff;
    }
    .admin-btn.btn-danger {
      background: #e74c3c;
      color: #fff;
      border: none;
    }
    .admin-btn.btn-danger:hover, .admin-btn.btn-danger:focus {
      background: #c0392b;
      color: #fff;
    }
    .admin-btn + .admin-btn { margin-left: 8px; }
    .modal-header {
      background: var(--main-blue);
      color: #fff;
      border-bottom: 1px solid var(--main-silver);
    }
    .form-label { font-weight: 500; color: var(--main-blue-dark); }
    .form-control, .form-select {
      border-radius: 8px;
      border: 1px solid var(--main-silver);
      background: var(--main-white);
      color: #222;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--main-blue);
      box-shadow: 0 0 0 2px #b3e0ff33;
    }
    /* Highlight required fields */
    .form-control:invalid, .form-select:invalid {
      border-color: #dc3545;
      box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.25);
    }
    .form-control:invalid:focus, .form-select:invalid:focus {
      border-color: #dc3545;
      box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.25);
    }
    .admin-nav-mobile { display: none; }
    .sidebar-toggle-btn {
      position: fixed;
      top: 18px;
      left: 18px;
      z-index: 1100;
      background: var(--main-blue);
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1.5rem;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(126,200,227,0.08);
      transition: background 0.2s;
    }
    .sidebar-toggle-btn:hover { background: var(--main-blue-dark); }
    .sticky-toolbar {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--main-white);
      padding-top: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--main-silver);
    }
    .pagination .page-link {
      color: var(--main-blue-dark);
      border: 1px solid var(--main-silver);
      background: var(--main-white);
    }
    .pagination .page-item.active .page-link {
      background: var(--main-blue-dark);
      color: #fff;
      border-color: var(--main-blue-dark);
    }
    @media (max-width: 1200px) {
      .admin-sidebar { width: 180px; }
      .admin-content { margin-left: 180px; }
    }
    @media (max-width: 1024px) {
      .admin-sidebar { width: 160px; padding: 12px 0; }
      .admin-content { margin-left: 160px; padding: 18px 4px; }
      .admin-section-title { font-size: 1.1rem; }
      .admin-btn, .admin-btn.btn-success, .admin-btn.btn-danger { padding: 7px 12px; font-size: 1rem; }
      .form-control, .form-select { font-size: 1rem; }
      .modal-dialog { max-width: 95vw; }
      .modal-content { font-size: 1rem; }
      .sticky-toolbar { top: 0; }
      .admin-table th, .admin-table td { font-size: 0.98rem; }
      .admin-table { font-size: 0.98rem; }
      .admin-table-wrapper { overflow-x: auto; }
    }
    @media (max-width: 834px) {
      .admin-sidebar { width: 120px; padding: 8px 0; }
      .admin-content { margin-left: 120px; padding: 10px 2px; }
      .admin-section-title { font-size: 1rem; }
      .admin-btn, .admin-btn.btn-success, .admin-btn.btn-danger { padding: 6px 8px; font-size: 0.95rem; }
      .form-control, .form-select { font-size: 0.95rem; }
      .modal-dialog { max-width: 99vw; }
      .modal-content { font-size: 0.95rem; }
      .sticky-toolbar { top: 0; }
      .admin-table th, .admin-table td { font-size: 0.95rem; }
      .admin-table { font-size: 0.95rem; }
    }
    /* Toast ƒë·∫πp h∆°n, hi·ªáu ·ª©ng tr∆∞·ª£t ph·∫£i v√†o, bo g√≥c, icon */
    .custom-toast {
      min-width: 240px;
      margin-bottom: 12px;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      padding: 12px 18px;
      font-size: 1rem;
      position: relative;
      animation: slideInRight 0.5s cubic-bezier(.4,2,.6,1) both;
      opacity: 1;
      transition: opacity 0.7s;
    }
    .custom-toast.fade-out {
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s;
    }
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(100px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .toast-success { background: #e6f9ed; color: #1a7f37; border-left: 6px solid #1a7f37; }
    .toast-error { background: #ffeaea; color: #d32f2f; border-left: 6px solid #d32f2f; }
    .toast-warning { background: #fffbe6; color: #bfa100; border-left: 6px solid #bfa100; }
    .custom-toast .toast-icon { font-size: 1.3em; margin-right: 12px; }
    .custom-toast .toast-close { position: absolute; right: 10px; top: 10px; background: none; border: none; color: inherit; font-size: 1.1em; cursor: pointer; }
    .sticky-toolbar {
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--main-white);
      padding-top: 8px;
      padding-bottom: 8px;
    }
    .admin-btn.btn-cancel {
      background: var(--main-blue);
      color: #fff;
      border: none;
    }
    .admin-btn.btn-cancel:hover, .admin-btn.btn-cancel:focus {
      background: var(--main-blue-dark);
      color: #fff;
    }
    .admin-btn.btn-sm {
      min-width: 64px;
      padding: 6px 14px;
      font-size: 1rem;
    }
    .admin-form-btn-full {
      width: 100%;
      min-width: 120px;
      padding: 10px 0;
      font-size: 1.08rem;
      border-radius: 8px;
      margin-top: 8px;
    }
    /* Auto-resize textarea */
    #productImage {
      resize: vertical;
      min-height: 250px;
      max-height: 500px;
      font-family: monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      width: 100%;
      overflow-y: auto;
    }
    /* Auto-expand textarea on input */
    #productImage:focus {
      min-height: 300px;
    }
    /* Modal wider for better UX */
    #productModal .modal-dialog {
      max-width: 1200px;
    }
    /* Two column layout for product form */
    .product-form-row {
      display: flex;
      gap: 32px;
    }
    .product-form-col {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .product-form-col .mb-3 { margin-bottom: 0 !important; }
    .product-form-col-right {
      display: flex;
      flex-direction: column;
      gap: 18px;
      height: 100%;
      justify-content: stretch;
    }
    .product-form-col-right .mb-3 {
      background: #f8fbff;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(126,200,227,0.07);
      border: 1.5px solid #e0f0fa;
      padding: 18px 16px 10px 16px;
      display: flex;
      flex-direction: column;
      min-width: 0;
      width: 100%;
      flex: 1 1 0;
    }
    .product-form-col-right label.form-label {
      font-weight: 600;
      color: #3b5d50;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.05rem;
    }
    .product-form-col-right label[for="productStory"]::before {
      content: '\f02d'; /* fa-book-open */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: #7EC8E3;
      margin-right: 6px;
      font-size: 1.1em;
    }
    .product-form-col-right label[for="productImage"]::before {
      content: '\f03e'; /* fa-image */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: #7EC8E3;
      margin-right: 6px;
      font-size: 1.1em;
    }
    #productStory {
      background: #fff;
      border-radius: 8px;
      border: 1.5px solid #e0f0fa;
      transition: border-color 0.2s;
      font-size: 1rem;
      min-height: 180px;
      height: 220px;
      flex: 1 1 0;
      margin-bottom: 0;
      width: 100%;
    }
    #productImage {
      background: #fff;
      border-radius: 8px;
      border: 1.5px solid #e0f0fa;
      transition: border-color 0.2s;
      font-size: 1rem;
      min-height: 120px;
      height: 140px;
      flex: 1 1 0;
      margin-bottom: 0;
      width: 100%;
    }
    #productStory:focus, #productImage:focus {
      border-color: #7EC8E3;
      box-shadow: 0 0 0 2px #b6e6fa;
    }
    @media (max-width: 900px) {
      .product-form-row, .product-form-col-right { flex-direction: column; gap: 0; }
    }
    .product-form-row-2 {
      display: flex;
      gap: 18px;
      margin-top: 0;
    }
    .product-form-row-2 > .mb-3 { flex: 1; margin-bottom: 0 !important; }
    #productDescription { min-height: 120px; height: 140px; resize: vertical; }
    #productStory, #productImage { min-height: 120px; height: 120px; resize: vertical; }
    @media (max-width: 900px) {
      #productModal .modal-dialog { max-width: 98vw; }
      .product-form-row, .product-form-row-2 { flex-direction: column; gap: 0; }
    }
    .product-form-row-2 {
      display: flex;
      gap: 18px;
      margin-top: 0;
    }
    .product-form-row-2 > .mb-3 {
      flex: 1;
      margin-bottom: 0 !important;
      background: #f8fbff;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(126,200,227,0.07);
      border: 1.5px solid #e0f0fa;
      padding: 18px 16px 10px 16px;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .product-form-row-2 label.form-label {
      font-weight: 600;
      color: #3b5d50;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.05rem;
    }
    .product-form-row-2 label[for="productStory"]::before {
      content: '\f02d'; /* fa-book-open */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: #7EC8E3;
      margin-right: 6px;
      font-size: 1.1em;
    }
    .product-form-row-2 label[for="productImage"]::before {
      content: '\f03e'; /* fa-image */
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: #7EC8E3;
      margin-right: 6px;
      font-size: 1.1em;
    }
    #productStory {
      background: #fff;
      border-radius: 8px;
      border: 1.5px solid #e0f0fa;
      transition: border-color 0.2s;
      font-size: 1rem;
      min-height: 220px;
      height: 240px;
      margin-bottom: 0;
    }
    #productImage {
      background: #fff;
      border-radius: 8px;
      border: 1.5px solid #e0f0fa;
      transition: border-color 0.2s;
      font-size: 1rem;
      min-height: 120px;
      height: 140px;
      margin-bottom: 0;
    }
    #productStory:focus, #productImage:focus {
      border-color: #7EC8E3;
      box-shadow: 0 0 0 2px #b6e6fa;
    }
    @media (max-width: 900px) {
      .product-form-row-2 { flex-direction: column; gap: 0; }
    }
    /* Image Gallery Styles - Gi·ªëng nh∆∞ trong detail */
    .image-gallery-container {
      margin-top: 15px;
      border: 2px dashed #e0f0fa;
      border-radius: 12px;
      padding: 20px;
      background: #fafbfc;
      min-height: 200px;
    }
    .image-gallery-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }
    .image-preview-item {
      position: relative;
      display: inline-block;
      text-align: center;
      margin: 0;
    }
    .image-preview-item img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border: 2px solid #e0f0fa;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #fff;
    }
    .image-preview-item img:hover {
      border-color: #7EC8E3;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(126,200,227,0.2);
    }
    .image-preview-item .image-label {
      font-size: 0.85rem;
      color: #3b5d50;
      margin-top: 5px;
      font-weight: 500;
    }
    .image-remove-btn {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #dc3545;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 12px;
      line-height: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(220,53,69,0.3);
      transition: all 0.2s ease;
    }
    .image-remove-btn:hover {
      background: #c82333;
      transform: scale(1.1);
    }
    .image-gallery-empty {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 40px 20px;
    }
    .image-gallery-empty i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: #dee2e6;
    }
    .image-gallery-warning {
      text-align: center;
      color: #856404;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      font-size: 0.9rem;
    }
    .image-gallery-warning i {
      font-size: 1.5rem;
      margin-bottom: 8px;
      color: #f39c12;
    }
    /* Image Modal Styles */
    .image-modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      backdrop-filter: blur(5px);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .modal-image-content {
      position: relative;
      margin: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 20px;
      cursor: pointer;
    }
    .modal-image {
      max-width: 90%;
      max-height: 80%;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-origin: center center;
    }
    .modal-close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #fff;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      background: rgba(0,0,0,0.5);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .modal-close:hover {
      background: rgba(0,0,0,0.8);
      transform: scale(1.1);
    }
    .modal-controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 10001;
    }
    .control-btn {
      background: rgba(0,0,0,0.8);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transform: scale(1);
    }
    .control-btn:hover {
      background: rgba(0,0,0,0.95);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      transform: scale(1.1);
    }
    .control-btn:active {
      transform: scale(0.95);
      transition: transform 0.1s ease;
    }
    /* Thumbnail Gallery in Modal */
    .modal-thumbnails {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10001;
      max-width: 80%;
      overflow-x: auto;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
    .modal-thumbnail {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      opacity: 0.7;
      transform: scale(1);
    }
    .modal-thumbnail:hover {
      opacity: 1;
      transform: scale(1.1);
    }
    .modal-thumbnail.active {
      border-color: #fff;
      opacity: 1;
      box-shadow: 0 2px 8px rgba(255,255,255,0.3);
    }
    /* Responsive */
    @media (max-width: 768px) {
      .image-gallery-preview {
        gap: 10px;
      }
      .image-preview-item img {
        width: 80px;
        height: 80px;
      }
      .modal-image {
        max-width: 95%;
        max-height: 70%;
      }
      .modal-close {
        top: 10px;
        right: 15px;
        width: 40px;
        height: 40px;
        font-size: 25px;
      }
    }
  </style>
</head>
<body>
  <div id="globalLoading" style="display:none;position:fixed;z-index:20000;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.55);backdrop-filter:blur(2px);align-items:center;justify-content:center;">
    <div style="display:flex;flex-direction:column;align-items:center;">
      <div class="spinner-border text-info" style="width:3rem;height:3rem;" role="status"></div>
      <div style="margin-top:12px;font-weight:500;color:#3b5d50;">Ch·ªù ch√∫t nh√©...</div>
    </div>
  </div>
  <div class="container-fluid">
    <!-- Toast th√¥ng b√°o -->
    <div id="toastContainer" style="position: fixed; top: 24px; right: 24px; z-index: 9999;"></div>
      <!-- Image Modal for Gallery -->
  <div id="imageModal" class="image-modal">
    <div class="modal-image-content">
      <span class="modal-close" onclick="closeImageModal()">&times;</span>
      <img class="modal-image" id="modalImage" alt="Product Image">
      <div class="modal-thumbnails" id="modalThumbnails"></div>
      <div class="modal-controls">
        <button class="control-btn" onclick="zoomOut()" title="Thu nh·ªè">
          <i class="fas fa-search-minus"></i>
        </button>
        <button class="control-btn" onclick="resetZoom()" title="V·ªã tr√≠ m·∫∑c ƒë·ªãnh">
          <i class="fas fa-undo"></i>
        </button>
        <button class="control-btn" onclick="zoomIn()" title="Ph√≥ng to">
          <i class="fas fa-search-plus"></i>
        </button>
      </div>
    </div>
  </div>
    <div class="row">
      <nav class="col-lg-2 admin-sidebar d-none d-lg-block">
        <h2>Admin Panel</h2>
        <ul>
          <li><a href="#products" class="active" data-tab="products">Qu·∫£n l√Ω s·∫£n ph·∫©m</a></li>
          <li><a href="#blogs" data-tab="blogs">Qu·∫£n l√Ω blog</a></li>
        </ul>
      </nav>
      <div class="col-lg-10 admin-content">
        <div class="admin-nav-mobile mb-3">
          <select class="form-select" id="adminTabMobile">
            <option value="products">Qu·∫£n l√Ω s·∫£n ph·∫©m</option>
          </select>
        </div>
        <div id="tab-products" class="admin-tab">
          <div class="admin-section-title d-flex align-items-center justify-content-between">
            <span>Qu·∫£n l√Ω s·∫£n ph·∫©m</span>
            <span id="productCount" style="font-size:1rem;font-weight:400;color:#3b5d50;"></span>
          </div>
          <div class="sticky-toolbar d-flex align-items-center justify-content-between mb-3">
            <button class="admin-btn btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#productModal" id="btnAddProduct">+ Th√™m s·∫£n ph·∫©m</button>
            <button class="admin-btn btn btn-success mb-3" id="productCountBtn">T·ªïng: 0 s·∫£n ph·∫©m</button>
          </div>
          <div class="mb-3 d-flex align-items-center" style="gap:12px;">
            <input type="text" class="form-control" id="searchInput" placeholder="T√¨m ki·∫øm theo t√™n, gi√°, m√¥ t·∫£..." style="max-width:320px;">
          </div>
          <div class="admin-table-wrapper">
            <table class="table admin-table" id="productsTable">
            <thead>
              <tr>
                  <th style="cursor:pointer;" onclick="sortTable('id')">ID <span id="sortIcon-id"></span></th>
                  <th style="cursor:pointer;" onclick="sortTable('name')">T√™n s·∫£n ph·∫©m <span id="sortIcon-name"></span></th>
                  <th style="cursor:pointer;" onclick="sortTable('price')">Gi√° <span id="sortIcon-price"></span></th>
                  <th style="cursor:pointer;" onclick="sortTable('description')">M√¥ t·∫£ <span id="sortIcon-description"></span></th>
                  <th>·∫¢nh</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
                <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y b·∫±ng JS -->
            </tbody>
          </table>
          </div>
          <nav>
            <ul class="pagination" id="pagination" style="justify-content:center;"></ul>
          </nav>
        </div>
        <div id="tab-blogs" class="admin-tab d-none">
          <div class="admin-section-title d-flex align-items-center justify-content-between">
            <span>Qu·∫£n l√Ω blog</span>
            <button class="admin-btn btn-sm" id="blogCountBtn" style="pointer-events:auto;">T·ªïng: 0 b√†i vi·∫øt</button>
          </div>
          <div class="sticky-toolbar d-flex align-items-center justify-content-between mb-3">
            <button class="admin-btn btn-sm" data-bs-toggle="modal" data-bs-target="#blogModal" id="btnAddBlog">+ Th√™m b√†i vi·∫øt</button>
            <input type="text" class="form-control" id="searchBlogInput" placeholder="T√¨m ki·∫øm ti√™u ƒë·ªÅ, m√¥ t·∫£..." style="max-width:320px;">
          </div>
          <div class="admin-table-wrapper">
            <table class="table admin-table" id="blogsTable">
            <thead>
              <tr>
                  <th style="cursor:pointer;" onclick="sortBlogTable('id')">ID <span id="sortBlogIcon-id"></span></th>
                  <th style="cursor:pointer;" onclick="sortBlogTable('title')">Ti√™u ƒë·ªÅ <span id="sortBlogIcon-title"></span></th>
                  <th style="cursor:pointer;" onclick="sortBlogTable('content')">N·ªôi dung <span id="sortBlogIcon-content"></span></th>
                  <th style="cursor:pointer;" onclick="sortBlogTable('author')">T√°c gi·∫£ <span id="sortBlogIcon-author"></span></th>
                  <th style="cursor:pointer;" onclick="sortBlogTable('date')">Ng√†y <span id="sortBlogIcon-date"></span></th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
              <tbody></tbody>
          </table>
        </div>
          <nav>
            <ul class="pagination" id="blogPagination" style="justify-content:center;"></ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productModalLabel">Th√™m/S·ª≠a s·∫£n ph·∫©m</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="productForm">
            <input type="hidden" id="productRowIndex">
            <div class="mb-3" id="productIdGroup" style="display:none;">
              <label class="form-label">ID</label>
              <input type="text" class="form-control" id="productId" readonly>
            </div>
            <div class="product-form-row">
              <div class="product-form-col">
                <div class="mb-3">
                  <label class="form-label">T√™n s·∫£n ph·∫©m *</label>
                  <input type="text" class="form-control" id="productName" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Gi√° *</label>
                  <input type="text" class="form-control" id="productPrice" required inputmode="numeric" placeholder="000.000‚Ç´">
                </div>
                <div class="mb-3">
                  <label class="form-label">M√¥ t·∫£ *</label>
                  <textarea class="form-control" id="productDescription" rows="5" required></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Ch·∫•t li·ªáu *</label>
                  <input type="text" class="form-control" id="productMaterial" required placeholder="V√≠ d·ª•: G·ªó s·ªìi, Tre gi√†, V·∫£i b·ªë...">
                </div>
                <div class="mb-3">
                  <label class="form-label">K√≠ch th∆∞·ªõc *</label>
                  <input type="text" class="form-control" id="productSize" required placeholder="V√≠ d·ª•: 120√ó60cm, 80√ó40√ó45cm...">
                </div>
                <div class="mb-3">
                  <label class="form-label">Tr·ªçng l∆∞·ª£ng *</label>
                  <input type="text" class="form-control" id="productWeight" required placeholder="V√≠ d·ª•: 8.5kg, 12kg...">
                </div>
                <div class="mb-3">
                  <label class="form-label">T√¨nh tr·∫°ng</label>
                  <select class="form-control" id="productStatus">
                    <option value="C√≤n h√†ng">C√≤n h√†ng</option>
                    <option value="H·∫øt h√†ng">H·∫øt h√†ng</option>
                    <option value="ƒê·∫∑t h√†ng tr∆∞·ªõc">ƒê·∫∑t h√†ng tr∆∞·ªõc</option>
                  </select>
                </div>
              </div>
              <div class="product-form-col product-form-col-right">
                <div class="mb-3" style="width:100%;flex:1;">
                  <label class="form-label" for="productFeatures">ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t * (m·ªói d√≤ng 1 ƒë·∫∑c ƒëi·ªÉm)</label>
                  <textarea class="form-control" id="productFeatures" rows="4" required placeholder="L√†m th·ªß c√¥ng 100% t·ª´ tre gi√† t·ª± nhi√™n&#10;Thi·∫øt k·∫ø ƒë·ªôc b·∫£n, kh√¥ng tr√πng l·∫∑p&#10;B·∫£o h√†nh 2 nƒÉm, b·∫£o tr√¨ tr·ªçn ƒë·ªùi&#10;V·∫≠n chuy·ªÉn mi·ªÖn ph√≠ to√†n qu·ªëc"></textarea>
                </div>
                <div class="mb-3" style="width:100%;flex:1;">
                  <label class="form-label" for="productStory">C√¢u chuy·ªán ƒë·∫±ng sau s·∫£n ph·∫©m *</label>
                  <textarea class="form-control" id="productStory" rows="8" required placeholder="K·ªÉ c√¢u chuy·ªán v·ªÅ ngu·ªìn g·ªëc, qu√° tr√¨nh l√†m ra s·∫£n ph·∫©m, √Ω nghƒ©a vƒÉn h√≥a..."></textarea>
                </div>
                <div class="mb-3" style="width:100%;flex:1;">
                  <label class="form-label" for="productImage">·∫¢nh s·∫£n ph·∫©m * (URL, m·ªói d√≤ng 1 link, t·ªëi ƒëa 4 ·∫£nh)</label>
                  <div class="mb-2">
                    <a href="https://imgbb.com/" target="_blank" style="color: #007bff; text-decoration: underline; font-size: 0.9rem;">
                      üì∑ B·∫•m v√†o ƒë√¢y ƒë·ªÉ l·∫•y URL ·∫£nh
                    </a>
                  </div>
                  <textarea class="form-control" id="productImage" rows="4" required placeholder="https://...jpg&#10;https://...png&#10;https://...webp" style="min-height: 120px;"></textarea>
                  <!-- Image Gallery Preview -->
                  <div class="image-gallery-container">
                    <div class="image-gallery-preview" id="imageGalleryPreview">
                      <div class="image-gallery-empty">
                        <i class="fas fa-images"></i>
                        <div>Ch∆∞a c√≥ ·∫£nh n√†o</div>
                        <small>Nh·∫≠p URL ·∫£nh v√†o √¥ b√™n tr√™n ƒë·ªÉ xem preview</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button class="admin-btn btn-sm admin-form-btn-full" type="submit">L∆∞u</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal x√°c nh·∫≠n xo√° -->
  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteConfirmLabel">X√°c nh·∫≠n xo√° s·∫£n ph·∫©m</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s·∫£n ph·∫©m n√†y kh√¥ng?
        </div>
        <div class="modal-footer">
          <button type="button" class="admin-btn btn-cancel btn-sm" data-bs-dismiss="modal">Hu·ª∑</button>
          <button type="button" class="admin-btn btn-danger btn-sm" id="btnConfirmDelete">Xo√°</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal Th√™m/S·ª≠a Blog -->
  <div class="modal fade" id="blogModal" tabindex="-1" aria-labelledby="blogModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="blogModalLabel">Th√™m/S·ª≠a b√†i vi·∫øt</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="blogForm">
            <input type="hidden" id="blogRowIndex">
            <div class="mb-3" id="blogIdGroup" style="display:none;">
              <label class="form-label">ID</label>
              <input type="text" class="form-control" id="blogId" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Ti√™u ƒë·ªÅ</label>
              <input type="text" class="form-control" id="blogTitle" required>
            </div>
            <div class="mb-3">
              <label class="form-label">N·ªôi dung</label>
              <textarea class="form-control" id="blogContent"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">T√°c gi·∫£</label>
              <input type="text" class="form-control" id="blogAuthor">
            </div>
            <div class="mb-3">
              <label class="form-label">Ng√†y</label>
              <input type="text" class="form-control" id="blogDate" readonly>
            </div>
            <button class="admin-btn btn-sm admin-form-btn-full" type="submit">L∆∞u</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal x√°c nh·∫≠n xo√° blog -->
  <div class="modal fade" id="deleteBlogConfirmModal" tabindex="-1" aria-labelledby="deleteBlogConfirmLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header" style="background:var(--main-blue);color:#fff;">
          <h5 class="modal-title" id="deleteBlogConfirmLabel">X√°c nh·∫≠n xo√° b√†i vi·∫øt</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° b√†i vi·∫øt n√†y kh√¥ng?
            </div>
        <div class="modal-footer">
          <button type="button" class="admin-btn btn-cancel btn-sm" data-bs-dismiss="modal">Hu·ª∑</button>
          <button type="button" class="admin-btn btn-danger btn-sm" id="btnConfirmDeleteBlog">Xo√°</button>
        </div>
      </div>
    </div>
  </div>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script>
    const API_BASE = 'http://localhost:8080';
    function formatVND(number) {
      if (!number) return '';
      return Number(number).toLocaleString('vi-VN') + '‚Ç´';
    }
    function showToast(message, type = 'success') {
      let icon = '';
      let toastClass = '';
      if (type === 'success') { icon = '‚úîÔ∏è'; toastClass = 'toast-success'; }
      else if (type === 'danger' || type === 'error') { icon = '‚ùå'; toastClass = 'toast-error'; }
      else if (type === 'warning') { icon = '‚ö†Ô∏è'; toastClass = 'toast-warning'; }
      const toast = document.createElement('div');
      toast.className = `custom-toast ${toastClass}`;
      toast.innerHTML = `<span class="toast-icon">${icon}</span><span>${message}</span>`;
      document.getElementById('toastContainer').appendChild(toast);
      setTimeout(() => { toast.classList.add('fade-out'); }, 3000);
      setTimeout(() => { toast.remove(); }, 4000);
    }
    function showAdminTab(tab) {
      document.querySelectorAll('.admin-tab').forEach(function(el) {
        el.classList.add('d-none');
      });
      document.getElementById('tab-' + tab).classList.remove('d-none');
      document.querySelectorAll('.admin-sidebar a').forEach(function(a) {
        a.classList.remove('active');
        if (a.getAttribute('data-tab') === tab) a.classList.add('active');
      });
      document.getElementById('adminTabMobile').value = tab;
    }
    document.querySelectorAll('.admin-sidebar a').forEach(function(a) {
      a.addEventListener('click', function(e) {
        e.preventDefault();
        showAdminTab(this.getAttribute('data-tab'));
      });
    });
    document.getElementById('adminTabMobile').addEventListener('change', function() {
      showAdminTab(this.value);
    });
    const productsTableBody = document.querySelector('#productsTable tbody');
    let products = [];
    let filteredProducts = [];
    let currentPage = 1;
    const pageSize = 10;
    let currentSort = { key: '', asc: true };
    function renderProductCount() {
      document.getElementById('productCountBtn').innerText = `T·ªïng: ${products.length} s·∫£n ph·∫©m`;
    }
    document.getElementById('searchInput').addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      filteredProducts = products.filter(p =>
        p.name.toLowerCase().includes(q) ||
        formatVND(p.price).includes(q) ||
        p.description.toLowerCase().includes(q)
      );
      currentPage = 1;
      renderProducts();
      renderPagination();
      renderProductCount();
    });
    window.sortTable = function(key) {
      if (currentSort.key === key) currentSort.asc = !currentSort.asc;
      else { currentSort.key = key; currentSort.asc = true; }
      filteredProducts.sort((a, b) => {
        let va = a[key], vb = b[key];
        if (key === 'price') { va = Number(va); vb = Number(vb); }
        if (va < vb) return currentSort.asc ? -1 : 1;
        if (va > vb) return currentSort.asc ? 1 : -1;
        return 0;
      });
      renderSortIcons();
      renderProducts();
    };
    function renderSortIcons() {
      ['id','name','price','description'].forEach(k => {
        document.getElementById('sortIcon-'+k).innerText = (currentSort.key===k) ? (currentSort.asc?'‚ñ≤':'‚ñº') : '';
      });
    }
    function renderPagination() {
      const totalPages = Math.ceil(products.length / pageSize);
      const pag = document.getElementById('pagination');
      pag.innerHTML = '';
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = 'page-item' + (i === currentPage ? ' active' : '');
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.onclick = function(e) {
          e.preventDefault();
          currentPage = i;
          renderProducts();
          renderPagination();
          setTimeout(() => {
            document.getElementById('productsTable').scrollIntoView({ behavior: 'smooth' });
          }, 50);
        };
        pag.appendChild(li);
      }
    }
    function renderProducts() {
      const tbody = productsTableBody;
      tbody.innerHTML = '';
      let data = filteredProducts;
      const start = (currentPage-1)*pageSize;
      const end = start + pageSize;
      data = data.slice(start, end);
      data.forEach((p, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${formatVND(p.price)}</td>
          <td>${p.description}</td>
          <td><img src="${p.image}" alt="" style="max-width:60px;max-height:60px;cursor:pointer;" onclick="showImageModal('${p.image}')"></td>
          <td>
            <button class="admin-btn btn-sm" onclick="editProduct(${products.findIndex(x=>x.id===p.id)})">S·ª≠a</button>
            <button class="admin-btn btn-danger btn-sm" onclick="deleteProduct(${products.findIndex(x=>x.id===p.id)})">Xo√°</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      renderProductCount();
      renderSortIcons();
    }
    async function fetchProducts() {
      showGlobalLoading(true);
      const res = await fetch(`${API_BASE}/api/products`);
      products = await res.json();
      filteredProducts = products.slice();
      currentPage = 1;
      renderProducts();
      renderPagination();
      renderProductCount();
      showGlobalLoading(false);
    }
    document.getElementById('btnAddProduct').onclick = function() {
      document.getElementById('productForm').reset();
      document.getElementById('productRowIndex').value = '';
      document.getElementById('productModalLabel').innerText = 'Th√™m s·∫£n ph·∫©m';
      document.getElementById('productIdGroup').style.display = 'none';
      updateImageGallery(); // C·∫≠p nh·∫≠t gallery khi th√™m
    };
    window.editProduct = function(idx) {
      const p = products[idx];
      document.getElementById('productId').value = p.id;
      document.getElementById('productName').value = p.name;
      document.getElementById('productPrice').value = Number(p.price).toLocaleString('vi-VN');
      document.getElementById('productDescription').value = p.description;
      document.getElementById('productMaterial').value = p.material || '';
      document.getElementById('productSize').value = p.size || '';
      document.getElementById('productWeight').value = p.weight || '';
      document.getElementById('productStatus').value = p.status || 'C√≤n h√†ng';
      document.getElementById('productFeatures').value = p.features || '';
      document.getElementById('productStory').value = p.story || '';
      const imagesValue = (p.images || p.image || '').replace(/,/g, '\n');
      document.getElementById('productImage').value = imagesValue;
      setTimeout(() => {
        const textarea = document.getElementById('productImage');
        textarea.style.height = 'auto';
        const newHeight = Math.max(250, textarea.scrollHeight + 30);
        textarea.style.height = Math.min(newHeight, 500) + 'px';
      }, 100);
      document.getElementById('productRowIndex').value = idx + 2; // rowIndex trong sheet (b·∫Øt ƒë·∫ßu t·ª´ 2)
      document.getElementById('productModalLabel').innerText = 'S·ª≠a s·∫£n ph·∫©m';
      document.getElementById('productIdGroup').style.display = 'block';
      const urls = (p.images ? p.images.split(/[,]/) : [p.image]).map(s => s.trim()).filter(Boolean).slice(0, 4);
      if (urls.length) {
        imageGalleryPreview.innerHTML = urls.map((url, idx) => `
          <div class="image-preview-item">
            <button type="button" class="image-remove-btn" onclick="removeImage(${idx})" title="X√≥a ·∫£nh n√†y">
              <i class="fas fa-times"></i>
            </button>
            <img src="${url}" alt="Preview ${idx+1}" onclick="showImageModal('${url}', ${idx})">
            <div class="image-label">·∫¢nh ${idx+1}</div>
          </div>
        `).join('');
      } else {
        imageGalleryPreview.innerHTML = `
          <div class="image-gallery-empty">
            <i class="fas fa-images"></i>
            <div>Ch∆∞a c√≥ ·∫£nh n√†o</div>
            <small>Nh·∫≠p URL ·∫£nh v√†o √¥ b√™n tr√™n ƒë·ªÉ xem preview (t·ªëi ƒëa 4 ·∫£nh)</small>
          </div>
        `;
      }
      var modal = new bootstrap.Modal(document.getElementById('productModal'));
      modal.show();
    };
    function validateProductForm() {
      const name = document.getElementById('productName').value.trim();
      const price = document.getElementById('productPrice').value.replace(/\D/g, '');
      const description = document.getElementById('productDescription').value.trim();
      const material = document.getElementById('productMaterial').value.trim();
      const size = document.getElementById('productSize').value.trim();
      const weight = document.getElementById('productWeight').value.trim();
      const features = document.getElementById('productFeatures').value.trim();
      const story = document.getElementById('productStory').value.trim();
      const image = document.getElementById('productImage').value.trim();
      const imageUrls = image.split(/\n/).map(s => s.trim()).filter(Boolean);
      if (imageUrls.length > 4) {
        showToast('Ch·ªâ ƒë∆∞·ª£c ph√©p th√™m t·ªëi ƒëa 4 ·∫£nh! Vui l√≤ng x√≥a b·ªõt ·∫£nh.', 'warning');
        return false;
      }
      if (!name) {
        showToast('T√™n s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productName').focus();
        return false;
      }
      if (!price || isNaN(price) || Number(price) <= 0) {
        showToast('Gi√° s·∫£n ph·∫©m ph·∫£i l√† s·ªë l·ªõn h∆°n 0!', 'warning');
        document.getElementById('productPrice').focus();
        return false;
      }
      if (!description) {
        showToast('M√¥ t·∫£ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productDescription').focus();
        return false;
      }
      if (!material) {
        showToast('Ch·∫•t li·ªáu kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productMaterial').focus();
        return false;
      }
      if (!size) {
        showToast('K√≠ch th∆∞·ªõc kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productSize').focus();
        return false;
      }
      if (!weight) {
        showToast('Tr·ªçng l∆∞·ª£ng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productWeight').focus();
        return false;
      }
      if (!features) {
        showToast('ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productFeatures').focus();
        return false;
      }
      if (!story) {
        showToast('C√¢u chuy·ªán ƒë·∫±ng sau s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productStory').focus();
        return false;
      }
      if (!image) {
        showToast('·∫¢nh (URL) kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        document.getElementById('productImage').focus();
        return false;
      }
      if (!/^https?:\/\//.test(image)) {
        showToast('URL ·∫£nh ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://', 'warning');
        document.getElementById('productImage').focus();
        return false;
      }
      return true;
    }
    let deleteIdx = null;
    window.deleteProduct = function(idx) {
      deleteIdx = idx;
      var modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
      modal.show();
    };
    document.getElementById('btnConfirmDelete').onclick = async function() {
      if (deleteIdx !== null) {
        const rowIndex = deleteIdx + 2;
        showGlobalLoading(true);
        try {
          await fetch(`${API_BASE}/api/products/${rowIndex}`, { method: 'DELETE' });
          showToast('Xo√° s·∫£n ph·∫©m th√†nh c√¥ng!', 'danger');
          fetchProducts();
        } catch (e) {
          showToast('Xo√° s·∫£n ph·∫©m th·∫•t b·∫°i!', 'danger');
        }
        deleteIdx = null;
        var modal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
        modal.hide();
        showGlobalLoading(false);
      }
    };
    const priceInput = document.getElementById('productPrice');
    priceInput.addEventListener('input', function(e) {
      let value = this.value.replace(/\D/g, ''); // ch·ªâ l·∫•y s·ªë
      let selectionStart = this.selectionStart;
      let oldLength = this.value.length;
      if (value) {
        this.value = Number(value).toLocaleString('vi-VN') + '‚Ç´';
        let newLength = this.value.length;
        this.setSelectionRange(newLength - 1, newLength - 1);
      } else {
        this.value = '';
      }
    });
    priceInput.addEventListener('blur', function() {
      if (!this.value) this.value = '';
      else if (!/‚Ç´$/.test(this.value)) this.value += '‚Ç´';
    });
    document.getElementById('productForm').onsubmit = async function(e) {
      e.preventDefault();
      if (!validateProductForm()) return;
      const btn = this.querySelector('button[type="submit"]');
      btn.disabled = true;
      showGlobalLoading(true);
      const rowIndex = document.getElementById('productRowIndex').value;
      let imagesArr = document.getElementById('productImage').value
        .split(/\n/)
        .map(s => s.trim())
        .filter(Boolean);
      let imagesStr = imagesArr.join(','); // CHU·ªñI c√°c url c√°ch nhau d·∫•u ph·∫©y
      let product = {
        name: document.getElementById('productName').value,
        price: document.getElementById('productPrice').value.replace(/\D/g, ''),
        description: document.getElementById('productDescription').value,
        material: document.getElementById('productMaterial').value,
        size: document.getElementById('productSize').value,
        weight: document.getElementById('productWeight').value,
        status: document.getElementById('productStatus').value,
        features: document.getElementById('productFeatures').value,
        story: document.getElementById('productStory').value,
        image: imagesArr[0] || '', // ·∫£nh ƒë·∫°i di·ªán
        images: imagesStr // CHU·ªñI, kh√¥ng ph·∫£i m·∫£ng
      };
      try {
        if (rowIndex) {
          product.id = document.getElementById('productId').value;
          await fetch(`${API_BASE}/api/products/${rowIndex}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(product)
          });
          showToast('C·∫≠p nh·∫≠t s·∫£n ph·∫©m th√†nh c√¥ng!');
        } else {
          await fetch(`${API_BASE}/api/products`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(product)
          });
          showToast('Th√™m s·∫£n ph·∫©m th√†nh c√¥ng!');
        }
        var modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
        modal.hide();
        setTimeout(() => { btn.disabled = false; }, 500);
        fetchProducts();
      } catch (e) {
        showToast('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!', 'danger');
        btn.disabled = false;
      }
      showGlobalLoading(false);
    };
    const imageInput = document.getElementById('productImage');
    const imageGalleryPreview = document.getElementById('imageGalleryPreview');
    imageInput.addEventListener('input', function() {
      this.style.height = 'auto';
      const newHeight = Math.max(250, this.scrollHeight + 30);
      this.style.height = Math.min(newHeight, 500) + 'px';
      updateImageGallery();
    });
    function updateImageGallery() {
      const urls = imageInput.value.split(/\n/).map(s => s.trim()).filter(Boolean);
      if (urls.length) {
        imageGalleryPreview.innerHTML = urls.map((url, idx) => `
          <div class="image-preview-item">
            <button type="button" class="image-remove-btn" onclick="removeImage(${idx})" title="X√≥a ·∫£nh n√†y">
              <i class="fas fa-times"></i>
            </button>
            <img src="${url}" alt="Preview ${idx+1}" onclick="showImageModal('${url}', ${idx})">
            <div class="image-label">·∫¢nh ${idx+1}</div>
          </div>
        `).join('');
        if (urls.length > 4) {
          imageGalleryPreview.innerHTML += `
            <div class="image-gallery-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <div>Qu√° nhi·ªÅu ·∫£nh! Ch·ªâ ƒë∆∞·ª£c ph√©p t·ªëi ƒëa 4 ·∫£nh</div>
              <small>Vui l√≤ng x√≥a b·ªõt ${urls.length - 4} ·∫£nh ƒë·ªÉ c√≥ th·ªÉ l∆∞u</small>
            </div>
          `;
        }
      } else {
        imageGalleryPreview.innerHTML = `
          <div class="image-gallery-empty">
            <i class="fas fa-images"></i>
            <div>Ch∆∞a c√≥ ·∫£nh n√†o</div>
            <small>Nh·∫≠p URL ·∫£nh v√†o √¥ b√™n tr√™n ƒë·ªÉ xem preview (t·ªëi ƒëa 4 ·∫£nh)</small>
          </div>
        `;
      }
    }
    window.removeImage = function(index) {
      const textarea = document.getElementById('productImage');
      const urls = textarea.value.split(/\n/).map(s => s.trim()).filter(Boolean);
      if (index >= 0 && index < urls.length) {
        urls.splice(index, 1);
        textarea.value = urls.join('\n');
        updateImageGallery();
        showToast('ƒê√£ x√≥a ·∫£nh!', 'warning');
      }
    };
    let currentImageIndex = 0;
    let allImageUrls = [];
    window.switchImage = function(index) {
      if (index >= 0 && index < allImageUrls.length && index !== currentImageIndex) {
        currentImageIndex = index;
        const modalImg = document.getElementById('modalImage');
        const thumbnails = document.querySelectorAll('.modal-thumbnail');
        currentZoom = 1;
        modalImg.style.transform = 'scale(1)';
        modalImg.style.opacity = '0.7';
        setTimeout(() => {
          modalImg.src = allImageUrls[index];
          modalImg.style.opacity = '1';
        }, 150);
        thumbnails.forEach((thumb, idx) => {
          if (idx === index) {
            thumb.classList.add('active');
            thumb.style.transform = 'scale(1.1)';
            setTimeout(() => {
              thumb.style.transform = 'scale(1)';
            }, 200);
          } else {
            thumb.classList.remove('active');
          }
        });
      }
    }
    window.closeImageModal = function() {
      const modal = document.getElementById('imageModal');
      modal.style.opacity = '0';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
      const productModalEl = document.getElementById('productModal');
      if (productModalEl) {
        var productModal = new bootstrap.Modal(productModalEl);
        productModal.show();
      }
    }
    let currentZoom = 1;
    let isZooming = false;
    window.zoomIn = function() {
      if (isZooming) return; // Tr√°nh spam click
      isZooming = true;
      currentZoom = Math.min(currentZoom * 1.2, 3);
      const modalImg = document.getElementById('modalImage');
      modalImg.style.transform = `scale(${currentZoom})`;
      const btn = event.target.closest('.control-btn');
      if (btn) {
        btn.style.transform = 'scale(0.9)';
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
        }, 150);
      }
      setTimeout(() => {
        isZooming = false;
      }, 300);
    }
    window.zoomOut = function() {
      if (isZooming) return; // Tr√°nh spam click
      isZooming = true;
      currentZoom = Math.max(currentZoom / 1.2, 0.5);
      const modalImg = document.getElementById('modalImage');
      modalImg.style.transform = `scale(${currentZoom})`;
      const btn = event.target.closest('.control-btn');
      if (btn) {
        btn.style.transform = 'scale(0.9)';
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
        }, 150);
      }
      setTimeout(() => {
        isZooming = false;
      }, 300);
    }
    window.resetZoom = function() {
      if (isZooming) return; // Tr√°nh spam click
      isZooming = true;
      currentZoom = 1;
      const modalImg = document.getElementById('modalImage');
      modalImg.style.transform = 'scale(1)';
      const btn = event.target.closest('.control-btn');
      if (btn) {
        btn.style.transform = 'scale(0.9)';
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
        }, 150);
      }
      setTimeout(() => {
        isZooming = false;
      }, 300);
    }
    window.showImageModal = function(url, index = 0) {
      const textarea = document.getElementById('productImage');
      allImageUrls = textarea.value.split(/\n/).map(s => s.trim()).filter(Boolean);
      currentImageIndex = index;
      if (allImageUrls.length === 0) return;
      const modalImg = document.getElementById('modalImage');
      const modalThumbnails = document.getElementById('modalThumbnails');
      modalImg.src = url;
      currentZoom = 1;
      modalImg.style.transform = 'scale(1)';
      if (allImageUrls.length > 1) {
        modalThumbnails.innerHTML = allImageUrls.map((imgUrl, idx) => `
          <img src="${imgUrl}" alt="Thumbnail ${idx+1}" 
               class="modal-thumbnail ${idx === currentImageIndex ? 'active' : ''}"
               onclick="switchImage(${idx})">
        `).join('');
        modalThumbnails.style.display = 'flex';
      } else {
        modalThumbnails.style.display = 'none';
      }
      const modal = document.getElementById('imageModal');
      modal.style.display = 'block';
      modal.style.opacity = '0';
      setTimeout(() => {
        modal.style.opacity = '1';
      }, 10);
      const productModalEl = document.getElementById('productModal');
      if (productModalEl && productModalEl.classList.contains('show')) {
        bootstrap.Modal.getInstance(productModalEl).hide();
      }
    }
    document.getElementById('imageModal').addEventListener('click', function(e) {
      if (e.target === this || e.target.classList.contains('modal-image-content')) {
        closeImageModal();
      }
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('imageModal').style.display === 'block') {
        closeImageModal();
      }
    });
    document.getElementById('productCountBtn').onclick = function() {
      document.getElementById('productsTable').scrollIntoView({ behavior: 'smooth' });
    };
    let blogs = [];
    let blogCurrentPage = 1;
    const blogPageSize = 10;
    let blogCurrentSort = { key: '', asc: true };
    let allBlogs = [];
    async function fetchBlogs() {
      showGlobalLoading(true);
      const res = await fetch(`${API_BASE}/api/blogs`);
      allBlogs = await res.json();
      blogs = allBlogs.slice();
      blogCurrentPage = 1;
      renderBlogs();
      renderBlogPagination();
      renderBlogCount();
      showGlobalLoading(false);
    }
    function renderBlogCount() {
      document.getElementById('blogCountBtn').innerText = `T·ªïng: ${blogs.length} b√†i vi·∫øt`;
    }
    function renderBlogs() {
      const tbody = document.querySelector('#blogsTable tbody');
      tbody.innerHTML = '';
      let data = blogs.slice();
      if (blogCurrentSort.key) {
        data.sort((a, b) => {
          let va = a[blogCurrentSort.key], vb = b[blogCurrentSort.key];
          if (blogCurrentSort.key === 'date') { va = va || ''; vb = vb || ''; }
          if (va < vb) return blogCurrentSort.asc ? -1 : 1;
          if (va > vb) return blogCurrentSort.asc ? 1 : -1;
          return 0;
        });
      }
      const start = (blogCurrentPage-1)*blogPageSize;
      const end = start + blogPageSize;
      data = data.slice(start, end);
      data.forEach((b, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${b.id}</td>
          <td>${b.title}</td>
          <td>${b.content}</td>
          <td>${b.author}</td>
          <td>${b.date || ''}</td>
          <td>
            <button class="admin-btn btn-sm" onclick="editBlog(${blogs.findIndex(x=>x.id===b.id)})">S·ª≠a</button>
            <button class="admin-btn btn-danger btn-sm" onclick="deleteBlog(${blogs.findIndex(x=>x.id===b.id)})">Xo√°</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      renderBlogCount();
      renderBlogSortIcons();
    }
    function renderBlogSortIcons() {
      ['id','title','content','author','date'].forEach(k => {
        document.getElementById('sortBlogIcon-'+k).innerText = (blogCurrentSort.key===k) ? (blogCurrentSort.asc?'‚ñ≤':'‚ñº') : '';
      });
    }
    function renderBlogPagination() {
      const totalPages = Math.ceil(blogs.length / blogPageSize);
      const pag = document.getElementById('blogPagination');
      pag.innerHTML = '';
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = 'page-item' + (i === blogCurrentPage ? ' active' : '');
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.onclick = function(e) {
          e.preventDefault();
          blogCurrentPage = i;
          renderBlogs();
          renderBlogPagination();
          setTimeout(() => {
            document.getElementById('blogsTable').scrollIntoView({ behavior: 'smooth' });
          }, 50);
        };
        pag.appendChild(li);
      }
    }
    document.getElementById('searchBlogInput').addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      blogs = allBlogs.filter(b =>
        b.title.toLowerCase().includes(q) ||
        b.description.toLowerCase().includes(q)
      );
      blogCurrentPage = 1;
      renderBlogs();
      renderBlogPagination();
      renderBlogCount();
    });
    document.getElementById('btnAddBlog').onclick = function() {
      document.getElementById('blogForm').reset();
      document.getElementById('blogRowIndex').value = '';
      document.getElementById('blogModalLabel').innerText = 'Th√™m b√†i vi·∫øt';
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      document.getElementById('blogDate').value = `${yyyy}-${mm}-${dd}`;
    };
    window.editBlog = function(idx) {
      const b = blogs[idx];
      document.getElementById('blogTitle').value = b.title;
      document.getElementById('blogContent').value = b.content;
      document.getElementById('blogAuthor').value = b.author;
      document.getElementById('blogDate').value = b.date || '';
      document.getElementById('blogRowIndex').value = idx + 2;
      document.getElementById('blogModalLabel').innerText = 'S·ª≠a b√†i vi·∫øt';
      var modal = new bootstrap.Modal(document.getElementById('blogModal'));
      modal.show();
    };
    let blogDeleteIdx = null;
    window.deleteBlog = function(idx) {
      blogDeleteIdx = idx;
      var modal = new bootstrap.Modal(document.getElementById('deleteBlogConfirmModal'));
      modal.show();
    };
    document.getElementById('btnConfirmDeleteBlog').onclick = async function() {
      if (blogDeleteIdx !== null) {
        const rowIndex = blogDeleteIdx + 2;
        showGlobalLoading(true);
        try {
          await fetch(`${API_BASE}/api/blogs/${rowIndex}`, { method: 'DELETE' });
          showToast('Xo√° b√†i vi·∫øt th√†nh c√¥ng!', 'danger');
          fetchBlogs();
        } catch (e) {
          showToast('Xo√° b√†i vi·∫øt th·∫•t b·∫°i!', 'danger');
        }
        blogDeleteIdx = null;
        var modal = bootstrap.Modal.getInstance(document.getElementById('deleteBlogConfirmModal'));
        modal.hide();
        showGlobalLoading(false);
      }
    };
    function validateBlogForm() {
      const title = document.getElementById('blogTitle').value.trim();
      const content = document.getElementById('blogContent').value.trim();
      const author = document.getElementById('blogAuthor').value.trim();
      const date = document.getElementById('blogDate').value.trim();
      if (!title) {
        showToast('Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        return false;
      }
      if (!content) {
        showToast('N·ªôi dung kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        return false;
      }
      if (!author) {
        showToast('T√°c gi·∫£ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        return false;
      }
      if (!date) {
        showToast('Ng√†y kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'warning');
        return false;
      }
      return true;
    }
    document.getElementById('blogForm').onsubmit = async function(e) {
      e.preventDefault();
      if (!validateBlogForm()) return;
      const btn = this.querySelector('button[type="submit"]');
      btn.disabled = true;
      showGlobalLoading(true);
      const rowIndex = document.getElementById('blogRowIndex').value;
      let blog = {
        title: document.getElementById('blogTitle').value,
        content: document.getElementById('blogContent').value,
        author: document.getElementById('blogAuthor').value,
        date: document.getElementById('blogDate').value
      };
      try {
        if (rowIndex) {
          await fetch(`${API_BASE}/api/blogs/${rowIndex}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(blog)
          });
          showToast('C·∫≠p nh·∫≠t b√†i vi·∫øt th√†nh c√¥ng!');
        } else {
          await fetch(`${API_BASE}/api/blogs`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(blog)
          });
          showToast('Th√™m b√†i vi·∫øt th√†nh c√¥ng!');
        }
        var modal = bootstrap.Modal.getInstance(document.getElementById('blogModal'));
        modal.hide();
        setTimeout(() => { btn.disabled = false; }, 500);
        fetchBlogs();
      } catch (e) {
        showToast('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!', 'danger');
        btn.disabled = false;
      }
      showGlobalLoading(false);
    };
    document.querySelector('a[data-tab="blogs"]').addEventListener('click', fetchBlogs);
    fetchProducts();
    function showGlobalLoading(show=true) {
      document.getElementById('globalLoading').style.display = show ? 'flex' : 'none';
    }
  </script>
</body>
</html> 